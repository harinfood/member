<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HARINFOOD - Sistem Kartu Member</title>
    <meta name="description" content="Sistem Manajemen Kartu Member HARINFOOD - Daftar, kelola, dan cetak kartu member dengan mudah">
    <meta name="theme-color" content="#2c3e50">
    <link rel="manifest" id="manifest-placeholder">
    <link rel="apple-touch-icon" href="https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-bg: #ecf0f1;
            --dark-text: #2c3e50;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 1200px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .install-prompt {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: none;
        }

        .install-prompt:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .install-prompt.show {
            display: block;
            animation: slideInRight 0.5s ease-out;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .nav-tabs {
            border: none;
            background: var(--light-bg);
            padding: 20px 20px 0 20px;
        }

        .nav-tabs .nav-link {
            border: none;
            background: transparent;
            color: var(--dark-text);
            font-weight: 600;
            padding: 15px 25px;
            margin-right: 10px;
            border-radius: 15px 15px 0 0;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link:hover {
            background: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: var(--primary-color);
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab-content {
            background: white;
            padding: 30px;
            border-radius: 0 0 20px 20px;
        }

        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 12px 15px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
            transform: translateY(-1px);
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            border: none;
            position: relative;
            overflow: hidden;
        }

        .btn-custom::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-custom:hover::before {
            left: 100%;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, var(--secondary-color), #5dade2);
            color: white;
        }

        .btn-primary-custom:hover {
            background: linear-gradient(135deg, #2980b9, var(--secondary-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-success-custom {
            background: linear-gradient(135deg, var(--success-color), #58d68d);
            color: white;
        }

        .btn-success-custom:hover {
            background: linear-gradient(135deg, #229954, var(--success-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .btn-warning-custom {
            background: linear-gradient(135deg, var(--warning-color), #f7dc6f);
            color: white;
        }

        .btn-warning-custom:hover {
            background: linear-gradient(135deg, #d68910, var(--warning-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(243, 156, 18, 0.3);
        }

        .btn-danger-custom {
            background: linear-gradient(135deg, var(--accent-color), #ec7063);
            color: white;
        }

        .btn-danger-custom:hover {
            background: linear-gradient(135deg, #c0392b, var(--accent-color));
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.3);
        }

        .camera-container {
            position: relative;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .camera-container:hover {
            border-color: var(--secondary-color);
            background: rgba(52, 152, 219, 0.05);
        }

        #video {
            width: 100%;
            max-width: 300px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        #canvas {
            display: none;
        }

        .photo-preview {
            max-width: 200px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 10px auto;
        }

        .member-card {
            width: 300px;
            height: 450px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            padding: 30px 20px;
            position: relative;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .member-card-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .member-card-header h3 {
            color: #000;
            font-size: 1.8rem;
            font-weight: bold;
            margin: 0;
            letter-spacing: 2px;
        }

        .member-card-header small {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .member-card-body {
            text-align: center;
            margin-bottom: 30px;
        }

        .member-photo {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #ddd;
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .member-info h4 {
            color: #000;
            font-size: 1.6rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .member-info p {
            color: #333;
            font-size: 1rem;
            margin: 5px 0;
        }

        .barcode-container {
            text-align: center;
            margin-top: auto;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .alert-custom {
            border-radius: 15px;
            border: none;
            padding: 15px 20px;
            margin: 20px 0;
            font-weight: 500;
        }

        .table-custom {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .table-custom thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .table-custom tbody tr:hover {
            background: rgba(52, 152, 219, 0.05);
            transform: scale(1.01);
            transition: all 0.3s ease;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 0.3em solid rgba(52, 152, 219, 0.25);
            border-right-color: var(--secondary-color);
        }

        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            animation: slideInLeft 0.5s ease-out;
        }

        .offline-indicator.online {
            background: #27ae60;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            
            #cardToDownload, #cardToDownload * {
                visibility: visible;
            }
            
            #cardToDownload {
                position: absolute;
                left: 0;
                top: 0;
                width: 300px !important;
                height: 450px !important;
                margin: 0 !important;
                box-shadow: none !important;
            }
            
            @page {
                size: A4;
                margin: 20mm;
            }
        }

        /* Responsive Design - Portrait Mode (Mobile) */
        @media (max-width: 768px) and (orientation: portrait) {
            .header h1 {
                font-size: 2rem;
            }
            
            .member-card {
                width: 100%;
                max-width: 350px;
            }
            
            .nav-tabs .nav-link {
                padding: 10px 15px;
                font-size: 14px;
            }

            .install-prompt {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 10px;
                display: block !important;
            }

            .main-container {
                margin: 10px;
            }

            .tab-content {
                padding: 20px 15px;
            }

            #video {
                max-width: 100%;
                width: 280px;
            }

            .camera-container {
                padding: 15px;
            }

            .btn-custom {
                padding: 10px 20px;
                font-size: 14px;
                margin: 5px 2px;
            }

            .table-responsive {
                font-size: 14px;
            }

            .member-photo {
                width: 120px;
                height: 120px;
            }

            .member-info h4 {
                font-size: 1.3rem;
            }
        }

        /* Responsive Design - Landscape Mode (Mobile/Tablet) */
        @media (max-width: 1024px) and (orientation: landscape) {
            body {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
            }

            .main-container {
                margin: 10px auto;
                max-width: 95%;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .nav-tabs {
                padding: 15px 15px 0 15px;
            }

            .nav-tabs .nav-link {
                padding: 12px 20px;
                font-size: 15px;
            }

            .tab-content {
                padding: 25px 20px;
            }

            /* Layout untuk form pendaftaran dalam landscape */
            .row {
                margin: 0 -10px;
            }

            .col-md-6, .col-md-4 {
                padding: 0 10px;
            }

            #video {
                max-width: 250px;
                width: 100%;
            }

            .camera-container {
                padding: 15px;
            }

            .btn-custom {
                padding: 10px 25px;
                font-size: 14px;
                margin: 3px;
            }

            /* Table adjustments for landscape */
            .table-custom {
                font-size: 14px;
            }

            .table-custom th,
            .table-custom td {
                padding: 8px 6px;
                vertical-align: middle;
            }

            /* Member card adjustments */
            .member-card {
                width: 280px;
                height: 420px;
                padding: 25px 18px;
            }

            .member-photo {
                width: 140px;
                height: 140px;
            }

            .member-info h4 {
                font-size: 1.4rem;
            }

            /* Button groups in landscape */
            .d-flex.flex-nowrap.gap-1 {
                gap: 2px !important;
            }

            .d-flex.flex-nowrap.gap-1 .btn {
                min-width: 28px;
                padding: 4px 6px;
                font-size: 12px;
            }

            /* Install prompt in landscape */
            .install-prompt {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 13px;
            }
        }

        /* Desktop/Large Screen Adjustments */
        @media (min-width: 1025px) {
            .main-container {
                max-width: 1400px;
            }

            .header h1 {
                font-size: 2.8rem;
            }

            .tab-content {
                padding: 40px;
            }

            #video {
                max-width: 350px;
            }

            .member-card {
                width: 320px;
                height: 480px;
            }
        }

        /* Orientation change handling */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 5px;
            }

            .nav-tabs {
                padding: 10px 15px 0 15px;
            }

            .nav-tabs .nav-link {
                padding: 8px 15px;
                font-size: 14px;
            }

            .tab-content {
                padding: 20px;
            }

            .member-card {
                width: 250px;
                height: 380px;
                padding: 20px 15px;
            }

            .member-photo {
                width: 120px;
                height: 120px;
            }
        }

        .modal-custom {
            backdrop-filter: blur(10px);
        }

        .modal-content-custom {
            border-radius: 20px;
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header-custom {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 20px 20px 0 0;
            border: none;
        }

        .btn-close-white {
            filter: invert(1) grayscale(100%) brightness(200%);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <div class="header">
                <h1><i class="fas fa-utensils"></i> HARINFOOD</h1>
                <p class="mb-0">Sistem Manajemen Kartu Member</p>
                <div class="install-prompt" id="installPrompt">
                    <i class="fas fa-download"></i> Install App
                </div>
            </div>

            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab">
                        <i class="fas fa-user-plus"></i> Daftar Member
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="members-tab" data-bs-toggle="tab" data-bs-target="#members" type="button" role="tab">
                        <i class="fas fa-users"></i> Daftar Member
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="card-tab" data-bs-toggle="tab" data-bs-target="#card" type="button" role="tab">
                        <i class="fas fa-id-card"></i> Cetak Kartu
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="mainTabContent">
                <!-- Tab Pendaftaran -->
                <div class="tab-pane fade show active" id="register" role="tabpanel">
                    <h3 class="mb-4"><i class="fas fa-user-plus text-primary"></i> Pendaftaran Member Baru</h3>
                    
                    <form id="memberForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Foto Member *</label>
                                    <div class="camera-container">
                                        <video id="video" autoplay playsinline></video>
                                        <canvas id="canvas"></canvas>
                                        <div id="photoPreview" style="display: none; position: relative;">
                                            <img id="capturedPhoto" class="photo-preview" alt="Foto Member">
                            <button type="button" class="btn btn-success-custom btn-sm" id="downloadPhotoBtn" onclick="downloadPhoto()" style="position: absolute; bottom: 10px; right: 10px; width: 30px; height: 30px; border-radius: 50%; padding: 0; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-down" style="font-size: 12px;"></i>
                            </button>
                                        </div>
                                        <div class="mt-3">
                                            <button type="button" class="btn btn-primary-custom btn-custom me-2" id="startCamera">
                                                <i class="fas fa-camera"></i> Buka Kamera
                                            </button>
                                            <button type="button" class="btn btn-success-custom btn-custom me-2" id="capturePhoto" style="display: none;">
                                                <i class="fas fa-camera-retro"></i> Ambil Foto
                                            </button>
                                            <button type="button" class="btn btn-warning-custom btn-custom" id="switchCamera" style="display: none;">
                                                <i class="fas fa-sync-alt"></i> Ganti Kamera
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="nama" class="form-label fw-bold">Nama Lengkap *</label>
                                    <input type="text" class="form-control" id="nama" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="alamat" class="form-label fw-bold">Alamat *</label>
                                    <textarea class="form-control" id="alamat" rows="3" required></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="whatsapp" class="form-label fw-bold">No. WhatsApp *</label>
                                    <input type="tel" class="form-control" id="whatsapp" placeholder="08xxxxxxxxxx" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="instagram" class="form-label fw-bold">Instagram</label>
                                    <input type="text" class="form-control" id="instagram" placeholder="@username">
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="facebook" class="form-label fw-bold">Facebook</label>
                                    <input type="text" class="form-control" id="facebook" placeholder="Nama Facebook">
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="tiktok" class="form-label fw-bold">TikTok</label>
                                    <input type="text" class="form-control" id="tiktok" placeholder="@username">
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-success-custom btn-custom btn-lg">
                                <i class="fas fa-save"></i> Daftar Member
                            </button>
                        </div>
                    </form>
                    
                    <div id="message"></div>
                    <div class="loading-spinner" id="loadingSpinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Sedang memproses...</p>
                    </div>
                </div>

                <!-- Tab Daftar Member -->
                <div class="tab-pane fade" id="members" role="tabpanel">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3><i class="fas fa-users text-primary"></i> Daftar Member</h3>
                        <div>
                            <button class="btn btn-success-custom btn-custom me-2" onclick="downloadExcel()">
                                <i class="fas fa-file-excel"></i> Download Excel
                            </button>
                            <button class="btn btn-primary-custom btn-custom" onclick="loadMembers()">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-custom">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Foto</th>
                                    <th>Nama</th>
                                    <th>WhatsApp</th>
                                    <th>Alamat</th>
                                    <th>Terdaftar</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="membersTable">
                                <tr>
                                    <td colspan="7" class="text-center">
                                        <div class="loading-spinner">
                                            <div class="spinner-border spinner-border-custom" role="status"></div>
                                            <p class="mt-2">Memuat data member...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab Cetak Kartu -->
                <div class="tab-pane fade" id="card" role="tabpanel">
                    <h3 class="mb-4"><i class="fas fa-id-card text-primary"></i> Cetak Kartu Member</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="selectMember" class="form-label fw-bold">Pilih Member</label>
                                <select class="form-select" id="selectMember">
                                    <option value="">Pilih member untuk dicetak kartunya</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary-custom btn-custom" onclick="generateCard()">
                                <i class="fas fa-id-card"></i> Generate Kartu
                            </button>
                            
                            <button class="btn btn-success-custom btn-custom ms-2" onclick="printCard()" id="printBtn" style="display: none;">
                                <i class="fas fa-print"></i> Cetak Kartu
                            </button>
                        </div>
                        
                        <div class="col-md-6">
                            <div id="memberCard" style="display: none;">
                                <div class="member-card" id="cardToDownload">
                                    <div class="member-card-header">
                                        <h3>HARINFOOD</h3>
                                        <small>Member Card</small>
                                    </div>
                                    <div class="member-card-body">
                                        <img id="cardPhoto" class="member-photo" alt="Foto Member">
                                        <div class="member-info">
                                            <h4 id="cardName"></h4>
                                        </div>
                                    </div>
                                    <div class="barcode-container">
                                        <svg id="barcode"></svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi"></i> <span id="connectionStatus">Offline</span>
    </div>

    <!-- Modal Edit Member -->
    <div class="modal fade modal-custom" id="editMemberModal" tabindex="-1" aria-labelledby="editMemberModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-content-custom">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title" id="editMemberModalLabel">
                        <i class="fas fa-user-edit"></i> Edit Member
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editMemberForm">
                        <input type="hidden" id="editMemberOriginalPhone">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label fw-bold">Foto Member</label>
                                    <div class="text-center">
                                        <img id="editMemberPhoto" class="photo-preview mb-3" alt="Foto Member" style="max-width: 200px;">
                                        <div>
                                            <button type="button" class="btn btn-primary-custom btn-custom" id="editStartCamera">
                                                <i class="fas fa-camera"></i> Ganti Foto
                                            </button>
                                        </div>
                                        <div id="editCameraContainer" style="display: none;" class="mt-3">
                                            <video id="editVideo" autoplay playsinline style="width: 100%; max-width: 300px; border-radius: 10px;"></video>
                                            <canvas id="editCanvas" style="display: none;"></canvas>
                                            <div class="mt-2">
                                                <button type="button" class="btn btn-success-custom btn-custom me-2" id="editCapturePhoto">
                                                    <i class="fas fa-camera-retro"></i> Ambil Foto
                                                </button>
                                                <button type="button" class="btn btn-danger-custom btn-custom" id="editCancelCamera">
                                                    <i class="fas fa-times"></i> Batal
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editNama" class="form-label fw-bold">Nama Lengkap *</label>
                                    <input type="text" class="form-control" id="editNama" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editAlamat" class="form-label fw-bold">Alamat *</label>
                                    <textarea class="form-control" id="editAlamat" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="editWhatsapp" class="form-label fw-bold">No. WhatsApp *</label>
                                    <input type="tel" class="form-control" id="editWhatsapp" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editInstagram" class="form-label fw-bold">Instagram</label>
                                    <input type="text" class="form-control" id="editInstagram">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editFacebook" class="form-label fw-bold">Facebook</label>
                                    <input type="text" class="form-control" id="editFacebook">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editTiktok" class="form-label fw-bold">TikTok</label>
                                    <input type="text" class="form-control" id="editTiktok">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger-custom btn-custom" onclick="deleteMember()">
                        <i class="fas fa-trash"></i> Hapus Member
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-success-custom btn-custom" onclick="updateMember()">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Generate Web App Manifest
        const manifest = {
            "name": "MEMBER CARD",
            "short_name": "MEMBER CARD",
            "description": "Sistem Manajemen Kartu Member HARINFOOD",
            "start_url": "./",
            "display": "standalone",
            "background_color": "#2c3e50",
            "theme_color": "#2c3e50",
            "orientation": "portrait",
            "icons": [
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "512x512",
                    "type": "image/png",
                    "purpose": "any maskable"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "256x256",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "192x192",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "144x144",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "96x96",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "72x72",
                    "type": "image/png",
                    "purpose": "any"
                },
                {
                    "src": "https://github.com/harinfood/scan/blob/main/icon-512.png?raw=true",
                    "sizes": "48x48",
                    "type": "image/png",
                    "purpose": "any"
                }
            ],
            "categories": ["business", "productivity"],
            "lang": "id"
        };

        // Create manifest blob and set href
        const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(manifestBlob);
        document.getElementById('manifest-placeholder').href = manifestURL;

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'harinfood-v1.0.0';
                    const urlsToCache = [
                        '/',
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css',
                        'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css',
                        'https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',
                        'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => {
                                    console.log('Opened cache');
                                    return cache.addAll(urlsToCache);
                                })
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                }
                            )
                        );
                    });

                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            })
                        );
                    });
                `;

                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);

                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installPrompt.classList.add('show');
        });

        installPrompt.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                installPrompt.classList.remove('show');
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            installPrompt.classList.remove('show');
        });

        // Online/Offline Status
        const offlineIndicator = document.getElementById('offlineIndicator');
        const connectionStatus = document.getElementById('connectionStatus');

        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineIndicator.classList.add('online');
                connectionStatus.innerHTML = '<i class="fas fa-wifi"></i> Online';
                setTimeout(() => {
                    offlineIndicator.style.display = 'none';
                }, 3000);
            } else {
                offlineIndicator.classList.remove('online');
                connectionStatus.innerHTML = '<i class="fas fa-wifi-slash"></i> Offline';
                offlineIndicator.style.display = 'block';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Check initial status
        updateOnlineStatus();

        // Local Storage Management
        const STORAGE_KEY = 'harinfood_members';
        
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let capturedPhotoData = null;
        let currentStream = null;
        let facingMode = 'user'; // 'user' untuk kamera depan, 'environment' untuk kamera belakang
        let editCurrentStream = null;
        let editCapturedPhotoData = null;

        // Fungsi untuk menyimpan data ke localStorage
        function saveToLocalStorage(members) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(members));
        }

        // Fungsi untuk mengambil data dari localStorage
        function getFromLocalStorage() {
            const data = localStorage.getItem(STORAGE_KEY);
            return data ? JSON.parse(data) : [];
        }

        // Fungsi untuk menambah member baru
        function addMemberToStorage(memberData) {
            const members = getFromLocalStorage();
            members.push(memberData);
            saveToLocalStorage(members);
            return true;
        }

        // Fungsi untuk update member
        function updateMemberInStorage(originalPhone, updatedMember) {
            const members = getFromLocalStorage();
            const index = members.findIndex(member => member.NO_WHATSAPP === originalPhone);
            if (index !== -1) {
                members[index] = updatedMember;
                saveToLocalStorage(members);
                return true;
            }
            return false;
        }

        // Fungsi untuk hapus member
        function deleteMemberFromStorage(phone) {
            const members = getFromLocalStorage();
            const filteredMembers = members.filter(member => member.NO_WHATSAPP !== phone);
            saveToLocalStorage(filteredMembers);
            return true;
        }

        // Fungsi untuk mencari member berdasarkan phone
        function findMemberByPhone(phone) {
            const members = getFromLocalStorage();
            return members.find(member => member.NO_WHATSAPP === phone);
        }

        // Polyfill untuk browser lama
        function getUserMediaPolyfill() {
            // Cek dukungan getUserMedia dengan berbagai prefix
            navigator.getUserMedia = navigator.getUserMedia ||
                                   navigator.webkitGetUserMedia ||
                                   navigator.mozGetUserMedia ||
                                   navigator.msGetUserMedia;

            // Polyfill untuk mediaDevices
            if (!navigator.mediaDevices) {
                navigator.mediaDevices = {};
            }

            // Polyfill untuk getUserMedia modern
            if (!navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia = function(constraints) {
                    return new Promise(function(resolve, reject) {
                        if (navigator.getUserMedia) {
                            navigator.getUserMedia(constraints, resolve, reject);
                        } else {
                            reject(new Error('getUserMedia tidak didukung di browser ini'));
                        }
                    });
                };
            }
        }

        // Fungsi untuk memulai kamera dengan kompatibilitas maksimal
        async function startCamera() {
            try {
                // Jalankan polyfill terlebih dahulu
                getUserMediaPolyfill();

                // Stop stream yang sedang berjalan
                if (currentStream) {
                    currentStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('Stopped existing track:', track.kind);
                    });
                    currentStream = null;
                }

                // Reset video element
                video.srcObject = null;
                video.src = '';

                // Cek dukungan kamera
                if (!navigator.mediaDevices && !navigator.getUserMedia) {
                    throw new Error('Browser tidak mendukung akses kamera');
                }

                console.log('Browser support check passed');
                console.log('User Agent:', navigator.userAgent);

                // Constraints yang lebih kompatibel
                let constraints = {
                    video: {
                        facingMode: facingMode,
                        width: { min: 320, ideal: 640, max: 1280 },
                        height: { min: 240, ideal: 480, max: 720 }
                    },
                    audio: false
                };

                console.log('Requesting camera with constraints:', constraints);
                showMessage('Meminta izin kamera...', 'info');

                // Coba dengan constraints lengkap terlebih dahulu
                try {
                    currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                } catch (detailedError) {
                    console.warn('Detailed constraints failed, trying basic:', detailedError);
                    
                    // Fallback ke constraints dasar
                    constraints = {
                        video: true,
                        audio: false
                    };
                    
                    currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                }

                if (!currentStream) {
                    throw new Error('Tidak dapat memperoleh stream kamera');
                }

                console.log('Camera stream obtained:', currentStream);
                console.log('Video tracks:', currentStream.getVideoTracks());

                // Set srcObject dengan error handling
                try {
                    video.srcObject = currentStream;
                } catch (srcError) {
                    console.warn('srcObject not supported, using createObjectURL');
                    // Fallback untuk browser lama
                    if (window.URL && window.URL.createObjectURL) {
                        video.src = window.URL.createObjectURL(currentStream);
                    } else {
                        throw new Error('Browser tidak mendukung video stream');
                    }
                }

                // Set atribut video untuk kompatibilitas maksimal
                video.setAttribute('playsinline', '');
                video.setAttribute('autoplay', '');
                video.setAttribute('muted', '');
                video.muted = true;
                video.playsInline = true;
                video.autoplay = true;

                // Wait for video to load dan play
                await new Promise((resolve, reject) => {
                    let resolved = false;
                    
                    const onSuccess = () => {
                        if (!resolved) {
                            resolved = true;
                            console.log('Video ready and playing');
                            resolve();
                        }
                    };

                    const onError = (error) => {
                        if (!resolved) {
                            resolved = true;
                            console.error('Video load/play error:', error);
                            reject(error);
                        }
                    };

                    // Multiple event listeners untuk memastikan kompatibilitas
                    video.onloadedmetadata = () => {
                        console.log('Video metadata loaded');
                        video.play().then(onSuccess).catch(onError);
                    };

                    video.oncanplay = () => {
                        console.log('Video can play');
                        if (video.readyState >= 2) {
                            video.play().then(onSuccess).catch(onError);
                        }
                    };

                    video.onplaying = onSuccess;
                    video.onerror = onError;
                    video.onabort = onError;

                    // Timeout fallback
                    setTimeout(() => {
                        if (!resolved) {
                            console.log('Forcing video play after timeout');
                            video.play().then(onSuccess).catch(onError);
                        }
                    }, 2000);

                    // Trigger load jika belum dimulai
                    if (video.readyState === 0) {
                        video.load();
                    }
                });

                // Update UI
                document.getElementById('startCamera').style.display = 'none';
                document.getElementById('capturePhoto').style.display = 'inline-block';
                document.getElementById('switchCamera').style.display = 'inline-block';
                document.getElementById('photoPreview').style.display = 'none';
                video.style.display = 'block';
                
                showMessage('Kamera berhasil diaktifkan! Siap mengambil foto.', 'success');
                
                // Log info stream untuk debugging
                const videoTrack = currentStream.getVideoTracks()[0];
                if (videoTrack) {
                    console.log('Video track settings:', videoTrack.getSettings());
                    console.log('Video track capabilities:', videoTrack.getCapabilities());
                }

            } catch (error) {
                console.error('Error accessing camera:', error);
                
                // Cleanup on error
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
                video.srcObject = null;
                
                let errorMessage = 'Gagal mengakses kamera. ';
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    errorMessage += 'Izin kamera ditolak. Silakan:\n';
                    errorMessage += ' Klik ikon kamera di address bar\n';
                    errorMessage += ' Pilih "Allow" atau "Izinkan"\n';
                    errorMessage += ' Refresh halaman dan coba lagi';
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    errorMessage += 'Kamera tidak ditemukan. Pastikan:\n';
                    errorMessage += ' Kamera terpasang dengan benar\n';
                    errorMessage += ' Tidak digunakan aplikasi lain\n';
                    errorMessage += ' Driver kamera terinstall';
                } else if (error.name === 'NotSupportedError' || error.name === 'NotReadableError') {
                    errorMessage += 'Browser atau perangkat tidak mendukung kamera.\n';
                    errorMessage += 'Coba gunakan browser Chrome, Firefox, atau Safari terbaru.';
                } else if (error.name === 'OverconstrainedError') {
                    errorMessage += 'Pengaturan kamera tidak kompatibel.\n';
                    errorMessage += 'Coba dengan kamera yang berbeda.';
                } else {
                    errorMessage += `Error: ${error.message}\n`;
                    errorMessage += 'Pastikan menggunakan HTTPS dan browser terbaru.';
                }
                
                showMessage(errorMessage, 'danger');
                
                // Reset UI
                document.getElementById('startCamera').style.display = 'inline-block';
                document.getElementById('capturePhoto').style.display = 'none';
                document.getElementById('switchCamera').style.display = 'none';
            }
        }

        // Fungsi untuk mengganti kamera
        async function switchCamera() {
            try {
                facingMode = facingMode === 'user' ? 'environment' : 'user';
                showMessage(`Beralih ke kamera ${facingMode === 'user' ? 'depan' : 'belakang'}...`, 'info');
                await startCamera();
            } catch (error) {
                console.error('Error switching camera:', error);
                showMessage('Gagal mengganti kamera!', 'danger');
            }
        }

        // Fungsi untuk mengambil foto dengan error handling yang lebih baik
        function capturePhoto() {
            try {
                console.log('Attempting to capture photo...');
                console.log('Video dimensions:', video.videoWidth, 'x', video.videoHeight);
                console.log('Video ready state:', video.readyState);
                
                // Validasi video ready
                if (!video || video.readyState < 2) {
                    throw new Error('Video belum siap untuk capture');
                }

                if (!video.videoWidth || !video.videoHeight || video.videoWidth === 0 || video.videoHeight === 0) {
                    throw new Error('Dimensi video tidak valid');
                }

                // Pastikan canvas tersedia
                if (!canvas) {
                    throw new Error('Canvas element tidak ditemukan');
                }

                const context = canvas.getContext('2d');
                if (!context) {
                    throw new Error('Tidak dapat membuat context 2D');
                }

                // Set ukuran canvas sesuai video
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                console.log('Canvas dimensions set to:', canvas.width, 'x', canvas.height);
                
                // Clear canvas terlebih dahulu
                context.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw video frame ke canvas
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // Cek apakah gambar berhasil di-draw
                const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                const hasContent = imageData.data.some(pixel => pixel !== 0);
                
                if (!hasContent) {
                    throw new Error('Gagal menangkap gambar dari video');
                }
                
                // Convert ke data URL dengan kualitas tinggi
                capturedPhotoData = canvas.toDataURL('image/jpeg', 0.9);
                
                if (!capturedPhotoData || capturedPhotoData === 'data:,' || capturedPhotoData.length < 1000) {
                    throw new Error('Data foto tidak valid atau kosong');
                }
                
                console.log('Photo captured successfully, size:', capturedPhotoData.length, 'bytes');
                
                // Update UI
                const capturedImg = document.getElementById('capturedPhoto');
                capturedImg.src = capturedPhotoData;
                capturedImg.onload = () => {
                    console.log('Photo preview loaded successfully');
                };
                capturedImg.onerror = () => {
                    console.error('Failed to load photo preview');
                    showMessage('Gagal menampilkan preview foto!', 'warning');
                };
                
                document.getElementById('photoPreview').style.display = 'block';
                video.style.display = 'none';
                
                document.getElementById('capturePhoto').style.display = 'none';
                document.getElementById('switchCamera').style.display = 'none';
                document.getElementById('startCamera').style.display = 'inline-block';
                
                // Stop camera stream untuk menghemat resource
                if (currentStream) {
                    currentStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('Stopped camera track:', track.kind);
                    });
                    currentStream = null;
                }
                
                showMessage('Foto berhasil diambil! Klik tombol download untuk menyimpan atau lanjutkan mengisi form.', 'success');
                
            } catch (error) {
                console.error('Error capturing photo:', error);
                
                let errorMessage = 'Gagal mengambil foto. ';
                
                if (error.message.includes('Video belum siap')) {
                    errorMessage += 'Tunggu hingga kamera sepenuhnya aktif, lalu coba lagi.';
                } else if (error.message.includes('Dimensi video tidak valid')) {
                    errorMessage += 'Kamera belum menampilkan gambar. Coba restart kamera.';
                } else if (error.message.includes('Canvas')) {
                    errorMessage += 'Terjadi masalah teknis. Refresh halaman dan coba lagi.';
                } else {
                    errorMessage += 'Pastikan kamera berfungsi dengan baik dan coba lagi.';
                }
                
                showMessage(errorMessage, 'danger');
                
                // Coba restart kamera jika capture gagal
                setTimeout(() => {
                    if (confirm('Apakah Anda ingin mencoba restart kamera?')) {
                        startCamera();
                    }
                }, 2000);
            }
        }

        // Fungsi untuk download image yang lebih kompatibel
        function downloadImage(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            link.style.display = 'none';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Fungsi untuk download foto yang sudah diambil
        function downloadPhoto() {
            if (capturedPhotoData) {
                try {
                    downloadImage(capturedPhotoData, `harinfood_member_${Date.now()}.jpg`);
                    showMessage('Foto berhasil didownload!', 'success');
                } catch (error) {
                    console.error('Error downloading photo:', error);
                    showMessage('Gagal mendownload foto!', 'danger');
                }
            } else {
                showMessage('Tidak ada foto untuk didownload!', 'warning');
            }
        }

        // Event listeners untuk kamera
        document.getElementById('startCamera').addEventListener('click', startCamera);
        document.getElementById('capturePhoto').addEventListener('click', capturePhoto);
        document.getElementById('switchCamera').addEventListener('click', switchCamera);

        // Fungsi untuk menampilkan pesan
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `
                <div class="alert alert-${type} alert-custom alert-dismissible fade show" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
        }

        // Fungsi untuk mengirim data member
        function submitMember(memberData) {
            document.getElementById('loadingSpinner').style.display = 'block';
            
            try {
                // Simpan ke localStorage
                const success = addMemberToStorage(memberData);
                
                if (success) {
                    showMessage('Member berhasil didaftarkan dan disimpan!', 'success');
                    document.getElementById('memberForm').reset();
                    capturedPhotoData = null;
                    document.getElementById('photoPreview').style.display = 'none';
                    document.getElementById('startCamera').style.display = 'inline-block';
                    video.style.display = 'block';
                    loadMembers(); // Refresh daftar member
                } else {
                    showMessage('Gagal mendaftarkan member!', 'danger');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('Terjadi kesalahan saat menyimpan data.', 'danger');
            } finally {
                document.getElementById('loadingSpinner').style.display = 'none';
            }
        }

        // Event listener untuk form submit
        document.getElementById('memberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validasi foto
            if (!capturedPhotoData) {
                showMessage('Silakan ambil foto terlebih dahulu!', 'warning');
                return;
            }
            
            // Validasi field wajib
            const nama = document.getElementById('nama').value.trim();
            const alamat = document.getElementById('alamat').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            
            if (!nama) {
                showMessage('Nama lengkap harus diisi!', 'warning');
                return;
            }
            
            if (!alamat) {
                showMessage('Alamat harus diisi!', 'warning');
                return;
            }
            
            if (!whatsapp) {
                showMessage('Nomor WhatsApp harus diisi!', 'warning');
                return;
            }
            
            // Validasi format WhatsApp
            const whatsappRegex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
            if (!whatsappRegex.test(whatsapp.replace(/\s/g, ''))) {
                showMessage('Format nomor WhatsApp tidak valid! Contoh: 08123456789', 'warning');
                return;
            }
            
            // Generate nomor member otomatis
            const memberNumber = Date.now().toString();
            
            const memberData = {
                action: 'addMember',
                NO: memberNumber,
                PHOTO: capturedPhotoData,
                NAMA: nama,
                ALAMAT: alamat,
                NO_WHATSAPP: whatsapp.replace(/\s/g, ''), // Hapus spasi
                INSTAGRAM: document.getElementById('instagram').value.trim() || '',
                FACEBOOK: document.getElementById('facebook').value.trim() || '',
                TIK_TOK: document.getElementById('tiktok').value.trim() || '',
                WAKTU_TERDAFTAR: new Date().toLocaleString('id-ID', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                })
            };
            
            console.log('Sending member data:', memberData);
            submitMember(memberData);
        });

        // Fungsi untuk memuat daftar member
        function loadMembers() {
            try {
                const members = getFromLocalStorage();
                const tbody = document.getElementById('membersTable');
                const selectMember = document.getElementById('selectMember');
                
                tbody.innerHTML = '';
                selectMember.innerHTML = '<option value="">Pilih member untuk dicetak kartunya</option>';
                
                if (members.length > 0) {
                    members.forEach((member, index) => {
                        // Tambah ke tabel
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td>${index + 1}</td>
                            <td style="position: relative;">
                                <img src="${member.PHOTO}" alt="Foto" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                                <button class="btn btn-sm btn-secondary" onclick="downloadMemberPhoto('${member.NO_WHATSAPP}')" title="Download Foto" style="position: absolute; top: 2px; right: 2px; width: 20px; height: 20px; padding: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 0.8;">
                                    <i class="fas fa-arrow-down" style="font-size: 8px;"></i>
                                </button>
                            </td>
                            <td>${member.NAMA}</td>
                            <td>${member.NO_WHATSAPP}</td>
                            <td>${member.ALAMAT}</td>
                            <td>${member.WAKTU_TERDAFTAR}</td>
                            <td>
                                <div class="d-flex flex-nowrap gap-1">
                                    <button class="btn btn-sm btn-warning-custom btn-custom" onclick="editMember('${member.NO_WHATSAPP}')" title="Edit Member" style="min-width: 32px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-primary-custom btn-custom" onclick="selectMemberForCard('${member.NO_WHATSAPP}')" title="Generate Kartu" style="min-width: 32px;">
                                        <i class="fas fa-id-card"></i>
                                    </button>
                                    <button class="btn btn-sm btn-success-custom btn-custom" onclick="downloadMemberCard('${member.NO_WHATSAPP}')" title="Download Kartu" style="min-width: 32px;">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger-custom btn-custom" onclick="deleteMemberFromList('${member.NO_WHATSAPP}', '${member.NAMA}')" title="Hapus Member" style="min-width: 32px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        `;
                        
                        // Tambah ke select
                        const option = document.createElement('option');
                        option.value = member.NO_WHATSAPP;
                        option.textContent = `${member.NAMA} (${member.NO_WHATSAPP})`;
                        option.dataset.member = JSON.stringify(member);
                        selectMember.appendChild(option);
                    });
                } else {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center">Tidak ada data member</td></tr>';
                }
            } catch (error) {
                console.error('Error loading members:', error);
                document.getElementById('membersTable').innerHTML = '<tr><td colspan="7" class="text-center text-danger">Gagal memuat data member</td></tr>';
            }
        }

        // Fungsi untuk memilih member untuk kartu
        function selectMemberForCard(whatsapp) {
            document.getElementById('selectMember').value = whatsapp;
            // Pindah ke tab cetak kartu
            const cardTab = new bootstrap.Tab(document.getElementById('card-tab'));
            cardTab.show();
        }

        // Fungsi untuk generate kartu member
        function generateCard() {
            const selectMember = document.getElementById('selectMember');
            const selectedOption = selectMember.options[selectMember.selectedIndex];
            
            if (!selectedOption.value) {
                showMessage('Silakan pilih member terlebih dahulu!', 'warning');
                return;
            }
            
            const member = JSON.parse(selectedOption.dataset.member);
            
            // Update kartu
            document.getElementById('cardPhoto').src = member.PHOTO;
            document.getElementById('cardName').textContent = member.NAMA;
            
            // Generate barcode
            JsBarcode("#barcode", member.NO_WHATSAPP, {
                format: "CODE128",
                width: 2.2,
                height: 100,
                displayValue: false,
                margin: 10
            });
            
            document.getElementById('memberCard').style.display = 'block';
            document.getElementById('printBtn').style.display = 'inline-block';
        }

        // Fungsi untuk cetak kartu
        function printCard() {
            const memberName = document.getElementById('cardName').textContent;
            
            try {
                window.print();
                showMessage(`Kartu member ${memberName} siap dicetak!`, 'success');
            } catch (error) {
                console.error('Error printing card:', error);
                showMessage('Gagal mencetak kartu!', 'danger');
            }
        }

        // Fungsi untuk download Excel
        function downloadExcel() {
            try {
                const members = getFromLocalStorage();
                
                if (members.length === 0) {
                    showMessage('Tidak ada data member untuk diexport!', 'warning');
                    return;
                }

                // Prepare data untuk Excel (tanpa foto karena ukuran file)
                const excelData = members.map((member, index) => ({
                    'No': index + 1,
                    'Nama': member.NAMA,
                    'Alamat': member.ALAMAT,
                    'No WhatsApp': member.NO_WHATSAPP,
                    'Instagram': member.INSTAGRAM || '',
                    'Facebook': member.FACEBOOK || '',
                    'TikTok': member.TIK_TOK || '',
                    'Waktu Terdaftar': member.WAKTU_TERDAFTAR
                }));

                // Create workbook dan worksheet
                const wb = XLSX.utils.book_new();
                const ws = XLSX.utils.json_to_sheet(excelData);

                // Set column widths
                const colWidths = [
                    { wch: 5 },  // No
                    { wch: 25 }, // Nama
                    { wch: 30 }, // Alamat
                    { wch: 15 }, // WhatsApp
                    { wch: 15 }, // Instagram
                    { wch: 15 }, // Facebook
                    { wch: 15 }, // TikTok
                    { wch: 20 }  // Waktu Terdaftar
                ];
                ws['!cols'] = colWidths;

                // Add worksheet ke workbook
                XLSX.utils.book_append_sheet(wb, ws, 'Data Member');

                // Generate filename dengan timestamp
                const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
                const filename = `HARINFOOD_Members_${timestamp}.xlsx`;

                // Download file
                XLSX.writeFile(wb, filename);
                
                showMessage(`File Excel berhasil didownload: ${filename}`, 'success');
            } catch (error) {
                console.error('Error downloading Excel:', error);
                showMessage('Gagal mendownload file Excel!', 'danger');
            }
        }

        // Fungsi untuk edit member
        function editMember(phone) {
            const member = findMemberByPhone(phone);
            if (!member) {
                showMessage('Member tidak ditemukan!', 'danger');
                return;
            }

            // Isi form edit dengan data member
            document.getElementById('editMemberOriginalPhone').value = phone;
            document.getElementById('editMemberPhoto').src = member.PHOTO;
            document.getElementById('editNama').value = member.NAMA;
            document.getElementById('editAlamat').value = member.ALAMAT;
            document.getElementById('editWhatsapp').value = member.NO_WHATSAPP;
            document.getElementById('editInstagram').value = member.INSTAGRAM || '';
            document.getElementById('editFacebook').value = member.FACEBOOK || '';
            document.getElementById('editTiktok').value = member.TIK_TOK || '';

            editCapturedPhotoData = member.PHOTO;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('editMemberModal'));
            modal.show();
        }

        // Fungsi untuk update member
        function updateMember() {
            const originalPhone = document.getElementById('editMemberOriginalPhone').value;
            const nama = document.getElementById('editNama').value.trim();
            const alamat = document.getElementById('editAlamat').value.trim();
            const whatsapp = document.getElementById('editWhatsapp').value.trim();

            if (!nama || !alamat || !whatsapp) {
                showMessage('Semua field wajib harus diisi!', 'warning');
                return;
            }

            // Validasi format WhatsApp
            const whatsappRegex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
            if (!whatsappRegex.test(whatsapp.replace(/\s/g, ''))) {
                showMessage('Format nomor WhatsApp tidak valid!', 'warning');
                return;
            }

            const updatedMember = {
                NO: Date.now().toString(),
                PHOTO: editCapturedPhotoData,
                NAMA: nama,
                ALAMAT: alamat,
                NO_WHATSAPP: whatsapp.replace(/\s/g, ''),
                INSTAGRAM: document.getElementById('editInstagram').value.trim(),
                FACEBOOK: document.getElementById('editFacebook').value.trim(),
                TIK_TOK: document.getElementById('editTiktok').value.trim(),
                WAKTU_TERDAFTAR: findMemberByPhone(originalPhone).WAKTU_TERDAFTAR // Keep original registration time
            };

            const success = updateMemberInStorage(originalPhone, updatedMember);
            
            if (success) {
                showMessage('Data member berhasil diupdate!', 'success');
                loadMembers();
                bootstrap.Modal.getInstance(document.getElementById('editMemberModal')).hide();
            } else {
                showMessage('Gagal mengupdate data member!', 'danger');
            }
        }

        // Fungsi untuk hapus member dari modal edit
        function deleteMember() {
            const originalPhone = document.getElementById('editMemberOriginalPhone').value;
            const member = findMemberByPhone(originalPhone);
            
            if (confirm(`Apakah Anda yakin ingin menghapus member ${member.NAMA}?`)) {
                const success = deleteMemberFromStorage(originalPhone);
                
                if (success) {
                    showMessage('Member berhasil dihapus!', 'success');
                    loadMembers();
                    bootstrap.Modal.getInstance(document.getElementById('editMemberModal')).hide();
                } else {
                    showMessage('Gagal menghapus member!', 'danger');
                }
            }
        }

        // Fungsi untuk hapus member langsung dari daftar
        function deleteMemberFromList(phone, nama) {
            if (confirm(`Apakah Anda yakin ingin menghapus member ${nama}?\n\nData yang dihapus tidak dapat dikembalikan!`)) {
                const success = deleteMemberFromStorage(phone);
                
                if (success) {
                    showMessage(`Member ${nama} berhasil dihapus!`, 'success');
                    loadMembers();
                } else {
                    showMessage('Gagal menghapus member!', 'danger');
                }
            }
        }

        // Fungsi untuk download foto member
        function downloadMemberPhoto(phone) {
            const member = findMemberByPhone(phone);
            if (!member) {
                showMessage('Member tidak ditemukan!', 'danger');
                return;
            }

            try {
                downloadImage(member.PHOTO, `HARINFOOD_Photo_${member.NAMA.replace(/\s+/g, '_')}_${Date.now()}.jpg`);
                showMessage(`Foto ${member.NAMA} berhasil didownload!`, 'success');
            } catch (error) {
                console.error('Error downloading photo:', error);
                showMessage('Gagal mendownload foto!', 'danger');
            }
        }

        // Fungsi untuk download kartu member langsung
        function downloadMemberCard(phone) {
            const member = findMemberByPhone(phone);
            if (!member) {
                showMessage('Member tidak ditemukan!', 'danger');
                return;
            }

            // Create temporary card element
            const tempCard = document.createElement('div');
            tempCard.style.position = 'absolute';
            tempCard.style.left = '-9999px';
            tempCard.style.top = '-9999px';
            tempCard.innerHTML = `
                <div class="member-card" style="width: 300px; height: 450px; background: white; border-radius: 15px; padding: 30px 20px; border: 2px solid #e0e0e0; font-family: Arial, sans-serif;">
                    <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #f0f0f0;">
                        <h3 style="color: #000; font-size: 1.8rem; font-weight: bold; margin: 0; letter-spacing: 2px;">HARINFOOD</h3>
                        <small style="color: #666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Member Card</small>
                    </div>
                    <div style="text-align: center; margin-bottom: 30px;">
                        <img src="${member.PHOTO}" style="width: 160px; height: 160px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; margin-bottom: 20px; display: block; margin-left: auto; margin-right: auto;" alt="Foto Member">
                        <div>
                            <h4 style="color: #000; font-size: 1.6rem; margin-bottom: 10px; font-weight: bold;">${member.NAMA}</h4>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: auto; padding-top: 20px; border-top: 2px solid #f0f0f0;">
                        <svg id="tempBarcode"></svg>
                    </div>
                </div>
            `;
            
            document.body.appendChild(tempCard);
            
            // Generate barcode
            JsBarcode("#tempBarcode", member.NO_WHATSAPP, {
                format: "CODE128",
                width: 2.2,
                height: 100,
                displayValue: false,
                margin: 10
            });
            
            // Convert to image and download
            html2canvas(tempCard.firstElementChild, {
                backgroundColor: '#ffffff',
                scale: 2,
                useCORS: true,
                allowTaint: true,
                width: 300,
                height: 450
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `HARINFOOD_Card_${member.NAMA.replace(/\s+/g, '_')}_${Date.now()}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                showMessage(`Kartu member ${member.NAMA} berhasil didownload!`, 'success');
                
                // Remove temporary element
                document.body.removeChild(tempCard);
            }).catch(error => {
                console.error('Error generating card image:', error);
                showMessage('Gagal mendownload kartu!', 'danger');
                document.body.removeChild(tempCard);
            });
        }

        // Event listeners untuk edit camera dengan kompatibilitas penuh
        document.getElementById('editStartCamera').addEventListener('click', async function() {
            try {
                // Jalankan polyfill untuk edit camera juga
                getUserMediaPolyfill();

                if (editCurrentStream) {
                    editCurrentStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('Stopped edit camera track:', track.kind);
                    });
                    editCurrentStream = null;
                }

                const editVideo = document.getElementById('editVideo');
                editVideo.srcObject = null;
                editVideo.src = '';

                // Cek dukungan kamera
                if (!navigator.mediaDevices && !navigator.getUserMedia) {
                    throw new Error('Browser tidak mendukung akses kamera untuk edit');
                }

                console.log('Starting edit camera...');
                showMessage('Meminta izin kamera untuk edit...', 'info');

                // Constraints untuk edit camera
                let constraints = {
                    video: {
                        facingMode: 'user',
                        width: { min: 320, ideal: 640, max: 1280 },
                        height: { min: 240, ideal: 480, max: 720 }
                    },
                    audio: false
                };

                // Coba dengan constraints lengkap terlebih dahulu
                try {
                    editCurrentStream = await navigator.mediaDevices.getUserMedia(constraints);
                } catch (detailedError) {
                    console.warn('Edit camera detailed constraints failed, trying basic:', detailedError);
                    
                    // Fallback ke constraints dasar
                    constraints = {
                        video: true,
                        audio: false
                    };
                    
                    editCurrentStream = await navigator.mediaDevices.getUserMedia(constraints);
                }

                if (!editCurrentStream) {
                    throw new Error('Tidak dapat memperoleh stream kamera edit');
                }

                console.log('Edit camera stream obtained:', editCurrentStream);

                // Set srcObject dengan error handling
                try {
                    editVideo.srcObject = editCurrentStream;
                } catch (srcError) {
                    console.warn('Edit video srcObject not supported, using createObjectURL');
                    if (window.URL && window.URL.createObjectURL) {
                        editVideo.src = window.URL.createObjectURL(editCurrentStream);
                    } else {
                        throw new Error('Browser tidak mendukung video stream untuk edit');
                    }
                }

                // Set atribut video untuk kompatibilitas maksimal
                editVideo.setAttribute('playsinline', '');
                editVideo.setAttribute('autoplay', '');
                editVideo.setAttribute('muted', '');
                editVideo.muted = true;
                editVideo.playsInline = true;
                editVideo.autoplay = true;

                // Wait for video to load dan play
                await new Promise((resolve, reject) => {
                    let resolved = false;
                    
                    const onSuccess = () => {
                        if (!resolved) {
                            resolved = true;
                            console.log('Edit video ready and playing');
                            resolve();
                        }
                    };

                    const onError = (error) => {
                        if (!resolved) {
                            resolved = true;
                            console.error('Edit video load/play error:', error);
                            reject(error);
                        }
                    };

                    editVideo.onloadedmetadata = () => {
                        console.log('Edit video metadata loaded');
                        editVideo.play().then(onSuccess).catch(onError);
                    };

                    editVideo.oncanplay = () => {
                        console.log('Edit video can play');
                        if (editVideo.readyState >= 2) {
                            editVideo.play().then(onSuccess).catch(onError);
                        }
                    };

                    editVideo.onplaying = onSuccess;
                    editVideo.onerror = onError;
                    editVideo.onabort = onError;

                    // Timeout fallback
                    setTimeout(() => {
                        if (!resolved) {
                            console.log('Forcing edit video play after timeout');
                            editVideo.play().then(onSuccess).catch(onError);
                        }
                    }, 2000);

                    // Trigger load jika belum dimulai
                    if (editVideo.readyState === 0) {
                        editVideo.load();
                    }
                });
                
                document.getElementById('editCameraContainer').style.display = 'block';
                showMessage('Kamera edit berhasil diaktifkan! Siap mengambil foto baru.', 'success');

            } catch (error) {
                console.error('Error accessing edit camera:', error);
                
                // Cleanup on error
                if (editCurrentStream) {
                    editCurrentStream.getTracks().forEach(track => track.stop());
                    editCurrentStream = null;
                }
                
                let errorMessage = 'Gagal mengakses kamera untuk edit. ';
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    errorMessage += 'Izin kamera ditolak untuk edit.';
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    errorMessage += 'Kamera tidak ditemukan untuk edit.';
                } else if (error.name === 'NotSupportedError' || error.name === 'NotReadableError') {
                    errorMessage += 'Browser tidak mendukung akses kamera untuk edit.';
                } else {
                    errorMessage += `Error: ${error.message}`;
                }
                
                showMessage(errorMessage, 'danger');
            }
        });

        document.getElementById('editCapturePhoto').addEventListener('click', function() {
            try {
                const editVideo = document.getElementById('editVideo');
                const editCanvas = document.getElementById('editCanvas');
                
                console.log('Attempting to capture edit photo...');
                console.log('Edit video dimensions:', editVideo.videoWidth, 'x', editVideo.videoHeight);
                console.log('Edit video ready state:', editVideo.readyState);
                
                // Validasi video ready
                if (!editVideo || editVideo.readyState < 2) {
                    throw new Error('Video edit belum siap untuk capture');
                }

                if (!editVideo.videoWidth || !editVideo.videoHeight || editVideo.videoWidth === 0 || editVideo.videoHeight === 0) {
                    throw new Error('Dimensi video edit tidak valid');
                }

                // Pastikan canvas tersedia
                if (!editCanvas) {
                    throw new Error('Canvas edit element tidak ditemukan');
                }

                const context = editCanvas.getContext('2d');
                if (!context) {
                    throw new Error('Tidak dapat membuat context 2D untuk edit');
                }

                // Set ukuran canvas sesuai video
                editCanvas.width = editVideo.videoWidth;
                editCanvas.height = editVideo.videoHeight;
                
                console.log('Edit canvas dimensions set to:', editCanvas.width, 'x', editCanvas.height);
                
                // Clear canvas terlebih dahulu
                context.clearRect(0, 0, editCanvas.width, editCanvas.height);
                
                // Draw video frame ke canvas
                context.drawImage(editVideo, 0, 0, editCanvas.width, editCanvas.height);
                
                // Cek apakah gambar berhasil di-draw
                const imageData = context.getImageData(0, 0, editCanvas.width, editCanvas.height);
                const hasContent = imageData.data.some(pixel => pixel !== 0);
                
                if (!hasContent) {
                    throw new Error('Gagal menangkap gambar dari video edit');
                }
                
                // Convert ke data URL dengan kualitas tinggi
                editCapturedPhotoData = editCanvas.toDataURL('image/jpeg', 0.9);
                
                if (!editCapturedPhotoData || editCapturedPhotoData === 'data:,' || editCapturedPhotoData.length < 1000) {
                    throw new Error('Data foto edit tidak valid atau kosong');
                }
                
                console.log('Edit photo captured successfully, size:', editCapturedPhotoData.length, 'bytes');
                
                // Update UI
                const editMemberPhoto = document.getElementById('editMemberPhoto');
                editMemberPhoto.src = editCapturedPhotoData;
                editMemberPhoto.onload = () => {
                    console.log('Edit photo preview loaded successfully');
                };
                editMemberPhoto.onerror = () => {
                    console.error('Failed to load edit photo preview');
                    showMessage('Gagal menampilkan preview foto edit!', 'warning');
                };
                
                document.getElementById('editCameraContainer').style.display = 'none';
                
                // Stop camera stream untuk menghemat resource
                if (editCurrentStream) {
                    editCurrentStream.getTracks().forEach(track => {
                        track.stop();
                        console.log('Stopped edit camera track:', track.kind);
                    });
                    editCurrentStream = null;
                }
                
                showMessage('Foto baru berhasil diambil untuk edit! Foto akan digunakan saat menyimpan perubahan.', 'success');
                
            } catch (error) {
                console.error('Error capturing edit photo:', error);
                
                let errorMessage = 'Gagal mengambil foto untuk edit. ';
                
                if (error.message.includes('Video edit belum siap')) {
                    errorMessage += 'Tunggu hingga kamera edit sepenuhnya aktif, lalu coba lagi.';
                } else if (error.message.includes('Dimensi video edit tidak valid')) {
                    errorMessage += 'Kamera edit belum menampilkan gambar. Coba restart kamera edit.';
                } else if (error.message.includes('Canvas edit')) {
                    errorMessage += 'Terjadi masalah teknis pada edit. Tutup modal dan coba lagi.';
                } else {
                    errorMessage += 'Pastikan kamera edit berfungsi dengan baik dan coba lagi.';
                }
                
                showMessage(errorMessage, 'danger');
                
                // Coba restart edit camera jika capture gagal
                setTimeout(() => {
                    if (confirm('Apakah Anda ingin mencoba restart kamera edit?')) {
                        document.getElementById('editStartCamera').click();
                    }
                }, 2000);
            }
        });

        document.getElementById('editCancelCamera').addEventListener('click', function() {
            document.getElementById('editCameraContainer').style.display = 'none';
            if (editCurrentStream) {
                editCurrentStream.getTracks().forEach(track => track.stop());
            }
        });

        // Orientation change handler
        function handleOrientationChange() {
            // Add a small delay to ensure the orientation change is complete
            setTimeout(() => {
                const isLandscape = window.innerWidth > window.innerHeight;
                const isMobile = window.innerWidth <= 1024;
                
                console.log(`Orientation changed: ${isLandscape ? 'Landscape' : 'Portrait'}, Mobile: ${isMobile}`);
                
                // Adjust layout based on orientation
                if (isLandscape && isMobile) {
                    document.body.classList.add('landscape-mode');
                    document.body.classList.remove('portrait-mode');
                } else {
                    document.body.classList.add('portrait-mode');
                    document.body.classList.remove('landscape-mode');
                }
                
                // Force refresh of any active camera streams to adjust to new orientation
                if (currentStream && video.srcObject) {
                    console.log('Refreshing camera for orientation change');
                    startCamera();
                }
                
                if (editCurrentStream && document.getElementById('editVideo').srcObject) {
                    console.log('Refreshing edit camera for orientation change');
                    document.getElementById('editStartCamera').click();
                }
            }, 100);
        }

        // Listen for orientation changes
        window.addEventListener('orientationchange', handleOrientationChange);
        window.addEventListener('resize', handleOrientationChange);

        // Fungsi untuk deteksi browser dan debugging
        function detectBrowserSupport() {
            const userAgent = navigator.userAgent;
            const isChrome = /Chrome/.test(userAgent) && /Google Inc/.test(navigator.vendor);
            const isFirefox = /Firefox/.test(userAgent);
            const isSafari = /Safari/.test(userAgent) && /Apple Computer/.test(navigator.vendor);
            const isEdge = /Edg/.test(userAgent);
            const isMobile = /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            console.log('Browser Detection:');
            console.log('- User Agent:', userAgent);
            console.log('- Chrome:', isChrome);
            console.log('- Firefox:', isFirefox);
            console.log('- Safari:', isSafari);
            console.log('- Edge:', isEdge);
            console.log('- Mobile:', isMobile);
            console.log('- HTTPS:', location.protocol === 'https:');
            
            // Cek dukungan getUserMedia
            const hasGetUserMedia = !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia);
            const hasLegacyGetUserMedia = !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia);
            
            console.log('Camera Support:');
            console.log('- Modern getUserMedia:', hasGetUserMedia);
            console.log('- Legacy getUserMedia:', hasLegacyGetUserMedia);
            console.log('- MediaDevices:', !!navigator.mediaDevices);
            
            // Tampilkan peringatan jika tidak ada dukungan kamera
            if (!hasGetUserMedia && !hasLegacyGetUserMedia) {
                showMessage('Browser Anda tidak mendukung akses kamera. Silakan gunakan Chrome, Firefox, Safari, atau Edge terbaru.', 'warning');
            } else if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                showMessage('Untuk keamanan, akses kamera memerlukan HTTPS. Beberapa fitur mungkin tidak berfungsi.', 'warning');
            }
            
            return {
                isChrome,
                isFirefox,
                isSafari,
                isEdge,
                isMobile,
                hasCamera: hasGetUserMedia || hasLegacyGetUserMedia,
                isSecure: location.protocol === 'https:' || location.hostname === 'localhost'
            };
        }

        // Fungsi untuk menampilkan info debug
        function showDebugInfo() {
            const browserInfo = detectBrowserSupport();
            console.log('=== HARINFOOD Camera Debug Info ===');
            console.log('Browser Support:', browserInfo);
            console.log('Screen Size:', window.innerWidth + 'x' + window.innerHeight);
            console.log('Device Pixel Ratio:', window.devicePixelRatio);
            console.log('Orientation:', window.innerWidth > window.innerHeight ? 'Landscape' : 'Portrait');
            
            // Cek available cameras
            if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                navigator.mediaDevices.enumerateDevices()
                    .then(devices => {
                        const videoDevices = devices.filter(device => device.kind === 'videoinput');
                        console.log('Available Cameras:', videoDevices.length);
                        videoDevices.forEach((device, index) => {
                            console.log(`Camera ${index + 1}:`, device.label || `Camera ${index + 1}`, device.deviceId);
                        });
                    })
                    .catch(error => {
                        console.log('Cannot enumerate devices:', error);
                    });
            }
        }

        // Load members saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== HARINFOOD Member Card System Loaded ===');
            
            // Jalankan deteksi browser dan debug info
            showDebugInfo();
            
            // Load data members
            loadMembers();
            
            // Set initial orientation
            handleOrientationChange();
            
            // Tambahkan event listener untuk debugging (tekan Ctrl+Shift+D)
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                    showDebugInfo();
                    showMessage('Debug info ditampilkan di console browser (F12)', 'info');
                }
            });
            
            console.log('System ready! Press Ctrl+Shift+D for debug info.');
        });

        // Event listener untuk tab change
        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(tab => {
            tab.addEventListener('shown.bs.tab', function(e) {
                if (e.target.id === 'members-tab') {
                    loadMembers();
                }
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9752a05ac4b1fd21',t:'MTc1NjIwMzkzOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
